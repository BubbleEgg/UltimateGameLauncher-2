<aside id="games-list">
    <div id="games">

    </div>
</aside>
<div id="games-main">
    <section id="header-section">
        <div id="header-img"></div>
        <h2 id="header-name"></h2>
    </section>
    <section id="game-content">
        <ul id="menu-items">
            <li>
                <div class="launch-btn">Launch</div>
            </li>
            <li>
                <div class="info-item">
                    <div class="info-title">Start with</div>
                    <div class="info-value">BubbleEgg</div>
                </div>
            </li>
        </ul>
    </section>
</div>

<script>
    const { ipcRenderer } = electron;
    const games = document.querySelector('#games');
    ipcRenderer.on('item:add', function (e, appid) {
        addApp(appid);
    });

    ipcRenderer.on('item:clear', function () {
        games.innerHTML = '';
    });

    window.removeItem = function(e) {
        e.target.parentElement.remove();
    }

    window.changeSteamUser = function (){
        changeUser({
            name: "SteamCTest01",
            pass: "test1877"
        });
    }

    window.parseData = function(data){
        data = sortData(data);
        for(app of data){
            const div = document.createElement('div');
            const img = document.createElement('img');
            const name = document.createElement('div');
            div.className = 'display';
            img.className = 'display-img';
            name.className = 'display-name';
            name.innerHTML = app.displayName;
            div.setAttribute("ondblclick", "openApp("+app.appId+")");
            div.setAttribute("onClick", "window.setCurrentGame("+app.appId+")")

            img.src = 'https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/'+app.appId+'/'+app.iconName+'.ico';
            div.appendChild(img);
            div.appendChild(name);
            games.appendChild(div);
        }
    }

    function sortData(data){
        data.sort(function(a, b){
            if(a.displayName < b.displayName) { return -1; }
            if(a.displayName > b.displayName) { return 1; }
            return 0;
        });
        return data;
    }

    window.setCurrentGame = function(appId){
        //https://steamcdn-a.akamaihd.net/steam/apps/4000/library_hero.jpg?t=1568744817

        const header = document.getElementById('header-img');
        const name = document.getElementById('header-name');

        image('https://steamcdn-a.akamaihd.net/steam/apps/'+appId+'/library_hero.jpg?t=1568744817', {
            success : function () {
                header.style.backgroundImage = "url('https://steamcdn-a.akamaihd.net/steam/apps/"+appId+"/library_hero.jpg?t=1568744817')";
            },
            failure : function () {
                header.style.backgroundImage = "url('https://steamcdn-a.akamaihd.net/steam/apps/"+appId+"/header.jpg?t=1568744817')";
            },
        });
        getAppsById(function(app) {
            name.innerText = app[0].displayName;
        }, [appId])
    }

    window.loadDataUser = function(){
        getAppsFromUser(function(data){
            parseData(data);
        }, "76561198082081394"); //76561198242115578 // 76561198085862571
    }

    window.loadDataUser();

    (function(){

        var parallax = document.querySelector("#header-img"),
            speed = 0.5;

        document.getElementById("games-main").onscroll = function(){
            var windowYOffset = document.getElementById("games-main").scrollTop;
            var elBackgrounPos = "50% " + (windowYOffset * speed) + "px";

            parallax.style.backgroundPosition = elBackgrounPos;
        };

    })();
</script>